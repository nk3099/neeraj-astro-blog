---
import BaseLayout from "./BaseLayout.astro";
import authorData from "../data/author.json";
import { FaClock } from "react-icons/fa6";

const { frontmatter, content } = Astro.props;
const title = frontmatter.title;
const description = frontmatter.description || frontmatter.title;
const formattedDate = new Date(frontmatter.publishedDate).toLocaleDateString("en-us", {
  weekday: "long",
  year: "numeric",
  month: "short",
  day: "numeric",
});

const readingTime = Math.ceil((String(content)?.split(/\s+/).length || 0) / 200);
---

<BaseLayout {title} {description}>
  <div class="container mx-auto mb-6">
    <article>
      <!-- Title Section -->
      <header class="mb-6">
        <h1 class="text-4xl font-bold">{frontmatter.title}</h1>
      </header>

      <!-- Metadata Section -->
      <section class="italic text-zinc-500 mb-4 mt-6 flex justify-between items-center">
        <p>Published on {formattedDate}</p>
        <div class="flex items-center gap-2">
          <FaClock />
          <p>{readingTime} min read</p>
        </div>
      </section>

      <hr class="border-gray-300 my-4" />

      <!-- Content Section -->
      <section class="markdown-content">
        <slot/>
      </section>

      <!-- Tags Section -->
      {frontmatter.tags && (
        <footer class="mt-6">
          <ul class="flex flex-wrap gap-2">
            <span>Tags:</span>
            {frontmatter.tags.map((tag) => (
              <li class="bg-blue-200 text-blue-900 px-3 py-1 rounded-lg">
                <a href={`/tags/${tag}/`} class="hover:underline">
                  #{tag}
                </a>
              </li>
            ))}
          </ul>
        </footer>
      )}

      <hr class="border-gray-300 my-4" />

      {frontmatter.hashnodeUrl && (
        <p class="text-lg">
          <em>
            Read the original blog
            <a
              href={frontmatter.hashnodeUrl}
              class="text-blue-900 hover:text-blue-400 underline"
            >here</a>.
          </em>
        </p>
      )}
    </article>
  </div>
</BaseLayout>

<style is:global>
  /* Markdown Content Styling */
  .markdown-content h1 {
    font-size: 2rem;
    font-weight: 700;
    margin-top: 1.5rem;
    margin-bottom: 1rem;
    line-height: 1.2;
  }

  .markdown-content h2 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .markdown-content h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 1.25rem;
    margin-bottom: 0.75rem;
  }

  .markdown-content h4 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
  }

  .markdown-content p {
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .markdown-content a {
    color: #2563eb;
    text-decoration: none;
  }

  .markdown-content a:hover {
    text-decoration: underline;
  }

  /* List styling - fixed to keep numbers and bullets separate */
  .markdown-content ul {
    list-style-type: disc;
    margin-left: 1.5rem;
    margin-bottom: 1rem;
  }

  .markdown-content ol {
    list-style-type: decimal;
    margin-left: 1.5rem;
    margin-bottom: 1rem;
  }

  /* Spacing for list items */
  .markdown-content li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
  }

  /* Nested list styling */
  .markdown-content ul ul,
  .markdown-content ol ol,
  .markdown-content ul ol,
  .markdown-content ol ul {
    margin-top: 0.5rem;
    margin-bottom: 0;
  }

  /* Ensure nested lists have appropriate styling */
  .markdown-content ol li ul {
    list-style-type: disc;
    margin-top: 0.5rem;
  }

  .markdown-content ul li ol {
    list-style-type: decimal;
    margin-top: 0.5rem;
  }

  .markdown-content blockquote {
    border-left: 4px solid #e5e7eb;
    padding-left: 1rem;
    margin-left: 0;
    margin-right: 0;
    font-style: italic;
    color: #4b5563;
  }

  /* Only style manually added HR elements in the markdown content */
  .markdown-content hr {
    border: 0;
    border-top: 1px solid #e5e7eb;
    margin: 1.5rem 0;
  }

  .markdown-content code {
    background-color: #f3f4f6;
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-family: monospace;
  }

  .markdown-content pre {
    background-color: #1e293b;
    color: #f8fafc;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin-bottom: 1rem;
  }

  .markdown-content pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
  }

  /* Enhanced image styling with padding */
  .markdown-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    margin: 1.5rem 0;
    padding: 0.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    background-color: white;
    border: 1px solid #e5e7eb;
  }

  /* Image container styling for better spacing */
  .markdown-content p:has(img) {
    padding: 0.5rem;
    margin: 1rem 0;
    display: flex;
    justify-content: center;
  }

  .markdown-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
  }

  .markdown-content th, .markdown-content td {
    border: 1px solid #e5e7eb;
    padding: 0.5rem;
  }

  .markdown-content th {
    background-color: #f3f4f6;
  }
</style>
